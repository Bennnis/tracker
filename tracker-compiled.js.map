{"version":3,"sources":["tracker.js"],"names":[],"mappings":"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","file":"tracker-compiled.js","sourcesContent":["/**\n * Created by Dandy on 12/28/17.\n * Version 1.0.0\n * License MIT\n */\n(function (g) {\n\n  //-----------------------------------------------------Ajax-Section-Start------------------------------------------------------\n  class Ajax {\n    send(url, method, data, headers, callbackSuccess, callbackFailed) {\n      var xhr = new XMLHttpRequest();  //Over IE7 Running Well\n\n      if (method === 'get') {\n        if (typeof data === 'object') {\n          var data_send = '?';\n          for (var key in data) {\n            data_send += key + '=' + data[key];\n            data_send += '&';\n          }\n          data_send = data_send.slice(0, -1);\n        }\n        xhr.open(method, url + data_send, true);\n        xhr.send(null);\n      }\n      else if (method === 'post') {\n        xhr.open(method, url, true);\n        for (var k in headers) {\n          xhr.setRequestHeader(k, headers[k]);\n        }\n\n        xhr.send(JSON.stringify(data));   //Convert Send-Data To Json Type\n      } else {\n        return false;\n      }\n\n      xhr.onreadystatechange = function () {  //Register Callback Functions\n        if (xhr.readyState === 4) {\n          if (xhr.status === 200) {\n            console.log('s');\n            if (callbackSuccess != null)\n              callbackSuccess(xhr.responseText);\n          }\n          else {\n            if (callbackFailed != null)\n              callbackFailed();\n            console.error('Server Error, Please Check Your Server ' + url + ' If Well');\n          }\n        }\n      };\n    }\n  }\n\n  //-----------------------------------------------------Ajax-Section-End--------------------------------------------------------\n\n\n  //----------------------------------------------------Tracker-Section-Start----------------------------------------------------\n\n  /**\n   *  @description  Tracker Private Variable\n   **/\n  let\n    opts = {},   //Merged Options\n\n    report_obj = {\n      tracker_msg: null,\n      tracker_file_url: null,\n      tracker_line: null,\n      tracker_column: null,\n      tracker_error_obj: null,\n      tracker_agent: null,\n      tracker_time: null,\n    },\n\n    report_manager = {\n      _queue: {},\n      _oldestIndex: 1,  //Pointer Of Report Queue Head\n      _newestIndex: 1,  //Pointer Of Report Queue Tail\n    };\n\n  /**\n   * @step1:  initialize ajax & listen errors\n   * @step2:  catch errors & format data & push to report queue\n   * @step3:  dequeue & send data & callback\n   **/\n\n  class Tracker {\n\n    constructor() {\n      this.ajax = new Ajax();\n      this.listenError();\n    }\n\n    /**\n     *  @name catchError\n     *  @flow-control:  listen & catch errors, format & enqueue, dequeue & report, catch response & run callback\n     **/\n    listenError() {\n      const _this = this;\n      try {\n        window.onerror = function (msg, url, line, column, errorObj) {\n          _setTrackerMessage(msg);\n          _setTrackerFileUrl(url);\n          _setTrackerLine(line);\n          _setTrackerColumn(column);\n          _setTrackerErrorObj(errorObj);\n          _setTrackerTime();\n          _setTrackerUserAgent();\n\n          _enQueue();\n          _this.reportTrack(_deQueue());\n        }\n      } catch (e) {\n        console.error(e);\n      }\n    }\n\n    reportTrack(data) {\n      this.ajax.send(opts.report_url, opts.method, data, opts.headers, opts.callbackSuccess, opts.callbackFailed)\n\n      /* @description: Send Tracker Data With Image & Callback Options Won't Work Anymore\n       *\n       *    var url = REPORT_URL + data.join('||');// 组装错误上报信息内容URL\n       *    var img = new Image;\n       *    img.onload = img.onerror = function(){\n       *      img = null;\n       *    };\n       *    img.src = url;// 发送数据到后台cgi\n       **/\n\n      /* @description: Send Tracker Data With sendBeacon && Callback Options Won't Work Anymore\n       *\n       *   sendBeacon(opts.url,data)\n       **/\n\n      // TODO: reportTrack method with sendBeacon & new Image() request\n    }\n  }\n\n  /**\n   *  @description  Tracker Private Functions\n   **/\n\n  var _enQueue = () => {\n    report_manager._queue[report_manager._oldestIndex] = report_obj;\n    report_manager._newestIndex++\n  };\n\n  var _deQueue = () => {\n    let deletedData;\n\n    if (report_manager._oldestIndex !== report_manager._newestIndex) {    //Judge Report-Queue If Suppose-Overflow Or Null\n      deletedData = report_manager._queue[report_manager._oldestIndex];\n      delete report_manager._queue[report_manager._oldestIndex++];\n\n      return deletedData;\n    }\n\n    throw new Error(\"Tracker Queue Is Full Stack\")\n  };\n\n  var _setTrackerMessage = (msg) => {\n    report_obj.tracker_msg = msg;\n  };\n\n  var _setTrackerFileUrl = (url) => {\n    report_obj.tracker_file_url = url;\n  };\n\n  var _setTrackerLine = (line) => {\n    report_obj.tracker_line = line;\n  };\n\n  var _setTrackerColumn = (column) => {\n    report_obj.tracker_column = column;\n  };\n\n  var _setTrackerErrorObj = (obj) => {\n    report_obj.tracker_error_obj = obj;\n  };\n\n  var _setTrackerUserAgent = () => {\n    report_obj.tracker_agent = navigator.userAgent;\n  };\n\n  var _setTrackerTime = () => {\n    report_obj.tracker_time = Date.now();\n  };\n\n  //----------------------------------------------------Tracker-Section-End------------------------------------------------------\n\n  /**\n   *  @description  Define Global Tracker Instance\n   **/\n  g.ErrorTracker = (function () {\n    const defaults = {\n      report_url: null,\n      method: 'post',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      callbackSuccess: null,\n      callbackFailed: null\n    };\n\n    return {\n      init: function (opt) {\n        if (!opt.report_url)\n          throw new Error(\"Tracker Report_Url Can't Be Null\");\n\n        opts = Object.assign('', defaults, opt);\n        return new Tracker();\n      }\n    }\n  })();\n\n})(typeof window === 'undefined' ? this : window);"]}