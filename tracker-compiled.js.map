{"version":3,"sources":["tracker.js"],"names":[],"mappings":"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","file":"tracker-compiled.js","sourcesContent":["/**\n * Created by humengtao on 12/28/17.\n */\n(function (g) {\n\n  //-----------------------------------------------------Ajax-Section-Start------------------------------------------------------\n  class Ajax {\n    send(url, method, data, callbackSuccess, callbackFailed) {\n      var xhr = new XMLHttpRequest();  //新建ajax请求，不兼容IE7以下\n      xhr.onreadystatechange = function () {  //注册回调函数\n        if (xhr.readyState === 4) {\n          if (xhr.status === 200) {\n            !!callbackSuccess && callbackSuccess(xhr.responseText);\n          }\n          else {\n            !!callbackFailed && callbackFailed();\n            console.error('Server Error, Please Check Your Server ' + url + 'If Running Well');\n          }\n        }\n      };\n      if (method === 'get') {  //如果是get方法，需要把data中的数据转化作为url传递给服务器\n        if (typeof data === 'object') {\n          var data_send = '?';\n          for (var key in data) {\n            data_send += key + '=' + data[key];\n            data_send += '&';\n          }\n          data_send = data_send.slice(0, -1);\n        }\n        xhr.open(method, url + data_send, true);\n        xhr.send(null);\n      }\n      else if (method === 'post') {   //如果是post，需要在头中添加content-type说明\n        xhr.open(method, url, true);\n        xhr.setRequestHeader('Content-Type', 'application/json');\n        xhr.send(JSON.stringify(data));//发送的数据需要转化成JSON格式\n      } else {\n        return false;\n      }\n    }\n  }\n\n  //-----------------------------------------------------Ajax-Section-End--------------------------------------------------------\n\n\n  //----------------------------------------------------Tracker-Section-Start----------------------------------------------------\n\n  /**\n   *  @description  Tracker Private Variable\n   **/\n  let\n    //用户自定义参数 report url, request method, headers\n    opts = {},\n\n    //错误信息对象\n    report_obj = {\n      tracker_msg: null,\n      tracker_file_url: null,\n      tracker_line: null,\n      tracker_column: null,\n      tracker_error_obj: null,\n      tracker_agent: null,\n      tracker_time: null,\n    }\n    ,\n\n    //错误信息队列管理对象\n    report_manager = {\n      _queue: {},\n      _oldestIndex: 1,  //队列头部指针\n      _newestIndex: 1,  //队列尾部指针\n    };\n\n  /**\n   * @step:  1.listen errors\n   * @step:  2.catch errors & format data & push to report queue\n   * @step:  3.queue actions & report\n   **/\n\n  class Tracker {\n\n    constructor() {\n      this.ajax = new Ajax();\n      this.listenError();\n    }\n\n    /**\n     *  @name catchError\n     *  @description 流程控制: 监听错误, 获取错误信息, 队列操作, 上报数据\n     **/\n    listenError() {\n      const _this = this;\n      try {\n        window.onerror = function (msg, url, line, column, errorObj) {\n          _setTrackerMessage(msg);\n          _setTrackerFileUrl(url);\n          _setTrackerLine(line);\n          _setTrackerColumn(column);\n          _setTrackerErrorObj(errorObj);\n          _setTrackerTime();\n          _setTrackerUserAgent();\n\n          _enQueue();\n          _this.reportTrack(_deQueue());\n        }\n      } catch (e) {\n        console.error(e);\n      }\n    }\n\n    reportTrack(data) {\n      this.ajax.send(opts.report_url, opts.method, data, opts.headers, opts.callbackSuccess, opts.callbackFailed)\n    }\n  }\n\n  /**\n   *  @description  Tracker Private Functions\n   **/\n\n  var _enQueue = ()=> {\n    report_manager._queue[report_manager._oldestIndex] = report_obj;\n    report_manager._newestIndex++\n  };\n\n  var _deQueue = ()=> {\n    let deletedData;\n    //判断是否存在假溢出、空队列的情况\n    if (report_manager._oldestIndex !== report_manager._newestIndex) {\n      deletedData = report_manager._queue[report_manager._oldestIndex];\n      delete report_manager._queue[report_manager._oldestIndex++];\n\n      return deletedData;\n    }\n\n    throw new Error(\"Tracker Queue Is Full Stack\")\n  };\n\n  var _setTrackerMessage = (msg)=> {\n    report_obj.tracker_msg = msg;\n  };\n\n  var _setTrackerFileUrl = (url)=> {\n    report_obj.tracker_file_url = url;\n  };\n\n  var _setTrackerLine = (line)=> {\n    report_obj.tracker_line = line;\n  };\n\n  var _setTrackerColumn = (column)=> {\n    report_obj.tracker_column = column;\n  };\n\n  var _setTrackerErrorObj = (obj)=> {\n    report_obj.tracker_error_obj = obj;\n  };\n\n  var _setTrackerUserAgent = ()=> {\n    report_obj.tracker_agent = navigator.userAgent;\n  };\n\n  var _setTrackerTime = ()=> {\n    report_obj.tracker_time = Date.now();\n  };\n\n  //----------------------------------------------------Tracker-Section-End------------------------------------------------------\n\n  /**\n   *  @description  Define Global Tracker Instance\n   **/\n  g.ErrorTracker = (function () {\n    const defaults = {\n      report_url: null,\n      method: 'post',\n      headers: null,\n      callbackSuccess: null,\n      callbackFailed: null\n    };\n\n    return {\n      init: function (opt) {\n        if (!opt.report_url)\n          throw new Error(\"Tracker Report_Url Can't Be Null\");\n\n        opts = Object.assign('', defaults, opt);\n        return new Tracker();\n      }\n    }\n  })();\n\n})(typeof window === 'undefined' ? this : window);"]}